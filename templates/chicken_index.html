<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ— ç‚¸é›å°å¸³ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa726 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #ff6b6b, #ffa726);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #ff6b6b;
        }
        
        .section h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #34495e;
        }
        
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #ff6b6b;
        }
        
        .btn {
            background: linear-gradient(135deg, #ff6b6b, #ffa726);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #00b894, #00a085);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-top: 4px solid #ff6b6b;
        }
        
        .stat-card h3 {
            color: #2c3e50;
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        
        .stat-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #ff6b6b;
        }
        
        .settlement-card {
            background: linear-gradient(135deg, #ff6b6b, #ffa726);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
        }
        
        .settlement-card h3 {
            font-size: 1.8em;
            margin-bottom: 15px;
        }
        
        .settlement-card .amount {
            font-size: 3em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background: #ff6b6b;
            color: white;
            font-weight: bold;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #c62828;
        }
        
        .success {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #2e7d32;
        }
        
        .hidden {
            display: none;
        }
        
        .price-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #ff6b6b;
        }
        
        .price-item label {
            min-width: 60px;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .price-item input {
            width: 100px;
            margin-right: 10px;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 5px;
        }
        
        .text-summary-section {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #ff6b6b;
        }
        
        .text-summary-container {
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .text-summary {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
            white-space: pre-wrap;
            margin: 0;
            color: #333;
        }
        
        .price-item input:focus {
            outline: none;
            border-color: #ff6b6b;
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
            margin-left: 10px;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .content {
                padding: 20px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ— ç‚¸é›å°å¸³ç³»çµ±</h1>
            <p>è‡ªå‹•åŒ–ç‚¸é›å“é …éŠ·å”®åˆ†æèˆ‡å°å¸³å ±å‘Šç”Ÿæˆ</p>
        </div>
        
        <div class="content">
            <!-- æ§åˆ¶é¢æ¿ -->
            <div class="section">
                <h2>ğŸ“Š æ§åˆ¶é¢æ¿</h2>
                <div class="form-group">
                    <label for="start-date">é–‹å§‹æ—¥æœŸï¼š</label>
                    <input type="date" id="start-date">
                </div>
                <div class="form-group">
                    <label for="end-date">çµæŸæ—¥æœŸï¼š</label>
                    <input type="date" id="end-date">
                </div>
                <button class="btn" onclick="loadRealData()">ğŸ— è¼‰å…¥çœŸå¯¦è³‡æ–™</button>
                <button class="btn btn-secondary" onclick="generateReport()">ğŸ“„ ç”Ÿæˆ Excel å ±å‘Š</button>
                <button class="btn btn-success" onclick="downloadReport()">ğŸ’¾ ä¸‹è¼‰ Excel æª”æ¡ˆ</button>
            </div>
            
            <!-- åƒ¹æ ¼è¨­å®šé¢æ¿ -->
            <div class="section">
                <h2>ğŸ’° åƒ¹æ ¼è¨­å®š</h2>
                <div id="price-settings">
                    <div class="price-item">
                        <label>é›æ’ï¼š</label>
                        <input type="number" id="chicken-cost" placeholder="æˆæœ¬" min="0" step="0.01">
                        <input type="number" id="chicken-price" placeholder="å”®åƒ¹" min="0" step="0.01">
                        <button class="btn btn-small" onclick="updatePrice('é›æ’')">æ›´æ–°</button>
                    </div>
                    <div class="price-item">
                        <label>åœ°ç“œï¼š</label>
                        <input type="number" id="sweet-potato-cost" placeholder="æˆæœ¬" min="0" step="0.01">
                        <input type="number" id="sweet-potato-price" placeholder="å”®åƒ¹" min="0" step="0.01">
                        <button class="btn btn-small" onclick="updatePrice('åœ°ç“œ')">æ›´æ–°</button>
                    </div>
                    <div class="price-item">
                        <label>æ£’è…¿ï¼š</label>
                        <input type="number" id="drumstick-cost" placeholder="æˆæœ¬" min="0" step="0.01">
                        <input type="number" id="drumstick-price" placeholder="å”®åƒ¹" min="0" step="0.01">
                        <button class="btn btn-small" onclick="updatePrice('æ£’è…¿')">æ›´æ–°</button>
                    </div>
                    <div class="price-item">
                        <label>é›ç¿…ï¼š</label>
                        <input type="number" id="wings-cost" placeholder="æˆæœ¬" min="0" step="0.01">
                        <input type="number" id="wings-price" placeholder="å”®åƒ¹" min="0" step="0.01">
                        <button class="btn btn-small" onclick="updatePrice('é›ç¿…')">æ›´æ–°</button>
                    </div>
                </div>
                <button class="btn btn-secondary" onclick="loadCurrentPrices()">ğŸ”„ è¼‰å…¥ç›®å‰åƒ¹æ ¼</button>
            </div>
            
            <!-- è¼‰å…¥ç‹€æ…‹ -->
            <div id="loading" class="loading hidden">
                <p>ğŸ”„ æ­£åœ¨è™•ç†ç‚¸é›è³‡æ–™ï¼Œè«‹ç¨å€™...</p>
            </div>
            
            <!-- éŒ¯èª¤è¨Šæ¯ -->
            <div id="error" class="error hidden"></div>
            
            <!-- æˆåŠŸè¨Šæ¯ -->
            <div id="success" class="success hidden"></div>
            
            <!-- ç‚¸é›è€é—†å°å¸³æ‘˜è¦ -->
            <div id="settlement-section" class="section hidden">
                <h2>ğŸ— ç‚¸é›è€é—†å°å¸³æ‘˜è¦</h2>
                <div id="settlement-card" class="settlement-card">
                    <h3>æ‡‰ä»˜é‡‘é¡</h3>
                    <div id="settlement-amount" class="amount">$0</div>
                    <p>æˆæœ¬æ¯”ä¾‹: <span id="cost-ratio">60%</span> | åˆ©æ½¤: $<span id="profit">0</span></p>
                </div>
                
                <!-- æ–‡å­—å°å¸³æ‘˜è¦ -->
                <div class="text-summary-section">
                    <h3>ğŸ“ èˆ‡è€é—†å°å¸³æ‘˜è¦</h3>
                    <div class="text-summary-container">
                        <pre id="text-summary" class="text-summary">è¼‰å…¥è³‡æ–™å¾Œæœƒé¡¯ç¤ºè©³ç´°çš„å°å¸³æ‘˜è¦</pre>
                    </div>
                    <button class="btn btn-small" onclick="copyTextSummary()">ğŸ“‹ è¤‡è£½æ‘˜è¦</button>
                </div>
            </div>
            
            <!-- çµ±è¨ˆæ‘˜è¦ -->
            <div id="stats-section" class="section hidden">
                <h2>ğŸ“ˆ ç‚¸é›éŠ·å”®çµ±è¨ˆæ‘˜è¦</h2>
                <div id="stats-grid" class="stats-grid"></div>
            </div>
            
            <!-- å“é …æ‘˜è¦ -->
            <div id="product-section" class="section hidden">
                <h2>ğŸ— å„å“é …éŠ·å”®æ‘˜è¦</h2>
                <div class="table-container">
                    <table id="product-table">
                        <thead>
                            <tr>
                                <th>å“é …</th>
                                <th>ç¸½æ•¸é‡</th>
                                <th>ç¸½é‡‘é¡</th>
                                <th>å¹³å‡å–®åƒ¹</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            
            <!-- æ¯æ—¥æ‘˜è¦ -->
            <div id="daily-section" class="section hidden">
                <h2>ğŸ“… æ¯æ—¥ç‚¸é›éŠ·å”®æ‘˜è¦</h2>
                <div class="table-container">
                    <table id="daily-table">
                        <thead>
                            <tr>
                                <th>æ—¥æœŸ</th>
                                <th>ç¸½æ•¸é‡</th>
                                <th>ç¸½é‡‘é¡</th>
                                <th>ç¸½æˆæœ¬</th>
                                <th>åˆ©æ½¤</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            
            <!-- è©³ç´°æ˜ç´° -->
            <div id="detail-section" class="section hidden">
                <h2>ğŸ“‹ è©³ç´°éŠ·å”®æ˜ç´°</h2>
                <div class="table-container">
                    <table id="detail-table">
                        <thead>
                            <tr>
                                <th>æ—¥æœŸ</th>
                                <th>å“é …</th>
                                <th>æ•¸é‡</th>
                                <th>å–®åƒ¹</th>
                                <th>æˆæœ¬</th>
                                <th>å°è¨ˆ</th>
                                <th>æˆæœ¬å°è¨ˆ</th>
                                <th>åˆ©æ½¤</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentReportData = null;
        let currentExcelFile = null;
        
        // è¼‰å…¥çœŸå¯¦è³‡æ–™
        async function loadRealData() {
            showLoading(true);
            hideMessages();
            
            try {
                const startDate = document.getElementById('start-date').value;
                const endDate = document.getElementById('end-date').value;
                
                let url = '/api/real_data';
                if (startDate && endDate) {
                    url += `?start_date=${startDate}&end_date=${endDate}`;
                }
                
                const response = await fetch(url);
                const result = await response.json();
                
                if (result.success) {
                    currentReportData = result.data;
                    displayData(result.data);
                    showMessage('success', `âœ… çœŸå¯¦ç‚¸é›è³‡æ–™è¼‰å…¥æˆåŠŸï¼(${startDate} åˆ° ${endDate})`);
                } else {
                    showMessage('error', 'âŒ è¼‰å…¥çœŸå¯¦è³‡æ–™å¤±æ•—ï¼š' + result.error);
                }
            } catch (error) {
                showMessage('error', 'âŒ è¼‰å…¥çœŸå¯¦è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š' + error.message);
            } finally {
                showLoading(false);
            }
        }
        
        
        // ç”Ÿæˆå ±å‘Š
        async function generateReport() {
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            
            if (!startDate || !endDate) {
                showMessage('error', 'âŒ è«‹é¸æ“‡é–‹å§‹å’ŒçµæŸæ—¥æœŸ');
                return;
            }
            
            showLoading(true);
            hideMessages();
            
            try {
                const response = await fetch('/api/generate_report', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        start_date: startDate,
                        end_date: endDate
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    currentReportData = result.report_data;
                    currentExcelFile = result.excel_file;
                    displayReportData(result.report_data);
                    showMessage('success', `âœ… ç‚¸é›å°å¸³å ±å‘Šç”ŸæˆæˆåŠŸï¼<br>ğŸ“„ Excel æª”æ¡ˆï¼š${result.excel_file}<br>ğŸ’¾ é»æ“Šã€Œä¸‹è¼‰å ±å‘Šã€æŒ‰éˆ•ä¸‹è¼‰æª”æ¡ˆ`);
                } else {
                    showMessage('error', 'âŒ ç”Ÿæˆå ±å‘Šå¤±æ•—ï¼š' + result.error);
                }
            } catch (error) {
                showMessage('error', 'âŒ ç”Ÿæˆå ±å‘Šæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š' + error.message);
            } finally {
                showLoading(false);
            }
        }
        
        // ä¸‹è¼‰å ±å‘Š
        function downloadReport() {
            if (!currentExcelFile) {
                showMessage('error', 'âŒ è«‹å…ˆç”Ÿæˆå ±å‘Š');
                return;
            }
            
            // å¾æª”æ¡ˆè·¯å¾‘ä¸­æå–æª”æ¡ˆåç¨±
            const filename = currentExcelFile.split('/').pop();
            
            // å»ºç«‹ä¸‹è¼‰é€£çµ
            const downloadUrl = `/api/download_report/${filename}`;
            
            // å»ºç«‹éš±è—çš„ a æ¨™ç±¤ä¾†è§¸ç™¼ä¸‹è¼‰
            const link = document.createElement('a');
            link.href = downloadUrl;
            link.download = filename;
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showMessage('success', `ğŸ’¾ æ­£åœ¨ä¸‹è¼‰å ±å‘Šï¼š${filename}`);
        }
        
        // é¡¯ç¤ºè³‡æ–™
        function displayData(data) {
            // é¡¯ç¤ºå°å¸³æ‘˜è¦
            displaySettlementInfo(data.settlement_info);
            
            // é¡¯ç¤ºçµ±è¨ˆæ‘˜è¦
            displayStats(data.settlement_info);
            
            // é¡¯ç¤ºå“é …æ‘˜è¦
            displayProductSummary(data.product_summary);
            
            // é¡¯ç¤ºæ¯æ—¥æ‘˜è¦
            displayDailySummary(data.daily_summary);
            
            // é¡¯ç¤ºè©³ç´°æ˜ç´°
            displayDetailSummary(data.raw_data);
            
            // é¡¯ç¤ºæ–‡å­—æ‘˜è¦ï¼ˆå¦‚æœæœ‰ï¼‰
            if (data.æ–‡å­—æ‘˜è¦) {
                document.getElementById('text-summary').textContent = data.æ–‡å­—æ‘˜è¦;
            }
            
            // é¡¯ç¤ºæ‰€æœ‰å€å¡Š
            showSections();
        }
        
        // é¡¯ç¤ºå ±å‘Šè³‡æ–™
        function displayReportData(data) {
            const stats = {
                ç¸½éŠ·å”®é‡‘é¡: data.ç¸½éŠ·å”®é‡‘é¡,
                ç¸½éŠ·å”®æ•¸é‡: data.ç¸½éŠ·å”®æ•¸é‡,
                ç‚¸é›è€é—†æ‡‰ä»˜é‡‘é¡: data.ç‚¸é›è€é—†æ‡‰ä»˜é‡‘é¡,
                æˆæœ¬æ¯”ä¾‹: data.æˆæœ¬æ¯”ä¾‹,
                åˆ©æ½¤: data.åˆ©æ½¤
            };
            
            displaySettlementInfo(stats);
            displayStats(stats);
            
            // é¡¯ç¤ºæ–‡å­—æ‘˜è¦
            if (data.æ–‡å­—æ‘˜è¦) {
                document.getElementById('text-summary').textContent = data.æ–‡å­—æ‘˜è¦;
            }
            
            showSections();
        }
        
        // é¡¯ç¤ºå°å¸³æ‘˜è¦
        function displaySettlementInfo(settlementInfo) {
            const amount = settlementInfo.ç‚¸é›è€é—†æ‡‰ä»˜é‡‘é¡ || 0;
            const costRatio = (settlementInfo.æˆæœ¬æ¯”ä¾‹ || 0.6) * 100;
            const profit = settlementInfo.åˆ©æ½¤ || 0;
            
            document.getElementById('settlement-amount').textContent = `$${amount.toLocaleString()}`;
            document.getElementById('cost-ratio').textContent = `${costRatio.toFixed(1)}%`;
            document.getElementById('profit').textContent = profit.toLocaleString();
        }
        
        // é¡¯ç¤ºçµ±è¨ˆæ‘˜è¦
        function displayStats(stats) {
            const statsGrid = document.getElementById('stats-grid');
            statsGrid.innerHTML = '';
            
            const statItems = [
                { label: 'ç¸½éŠ·å”®é‡‘é¡', value: `$${stats.ç¸½éŠ·å”®é‡‘é¡?.toLocaleString() || 0}`, color: '#ff6b6b' },
                { label: 'ç¸½éŠ·å”®æ•¸é‡', value: `${stats.ç¸½éŠ·å”®æ•¸é‡ || 0} ä»½`, color: '#00b894' },
                { label: 'å¹³å‡å–®åƒ¹', value: `$${stats.å¹³å‡å–®åƒ¹?.toFixed(2) || 0}`, color: '#74b9ff' },
                { label: 'å“é …ç¨®é¡', value: `${stats.å“é …ç¨®é¡ || 0} ç¨®`, color: '#fdcb6e' }
            ];
            
            statItems.forEach(item => {
                const statCard = document.createElement('div');
                statCard.className = 'stat-card';
                statCard.innerHTML = `
                    <h3>${item.label}</h3>
                    <div class="value" style="color: ${item.color}">${item.value}</div>
                `;
                statsGrid.appendChild(statCard);
            });
        }
        
        // é¡¯ç¤ºå“é …æ‘˜è¦
        function displayProductSummary(productData) {
            const tbody = document.querySelector('#product-table tbody');
            tbody.innerHTML = '';
            
            productData.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row.å“é …}</td>
                    <td>${row.ç¸½æ•¸é‡}</td>
                    <td>$${parseFloat(row.ç¸½é‡‘é¡).toLocaleString()}</td>
                    <td>$${parseFloat(row.å¹³å‡å–®åƒ¹).toFixed(2)}</td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        // é¡¯ç¤ºæ¯æ—¥æ‘˜è¦
        function displayDailySummary(dailyData) {
            const tbody = document.querySelector('#daily-table tbody');
            tbody.innerHTML = '';
            
            dailyData.forEach(row => {
                const tr = document.createElement('tr');
                const totalAmount = parseFloat(row.ç¸½é‡‘é¡);
                const totalCost = parseFloat(row.ç¸½æˆæœ¬ || 0);
                const profit = totalAmount - totalCost;
                tr.innerHTML = `
                    <td>${row.æ—¥æœŸ}</td>
                    <td>${row.ç¸½æ•¸é‡}</td>
                    <td>$${totalAmount.toLocaleString()}</td>
                    <td>$${totalCost.toLocaleString()}</td>
                    <td>$${profit.toLocaleString()}</td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        // é¡¯ç¤ºè©³ç´°æ˜ç´°
        function displayDetailSummary(detailData) {
            const tbody = document.querySelector('#detail-table tbody');
            tbody.innerHTML = '';
            
            detailData.forEach(row => {
                const tr = document.createElement('tr');
                const amount = parseFloat(row.å°è¨ˆ);
                const cost = parseFloat(row.æˆæœ¬å°è¨ˆ);
                const profit = amount - cost;
                tr.innerHTML = `
                    <td>${row.æ—¥æœŸ}</td>
                    <td>${row.å“é …}</td>
                    <td>${row.æ•¸é‡}</td>
                    <td>$${parseFloat(row.å–®åƒ¹).toFixed(2)}</td>
                    <td>$${parseFloat(row.æˆæœ¬).toFixed(2)}</td>
                    <td>$${amount.toLocaleString()}</td>
                    <td>$${cost.toLocaleString()}</td>
                    <td>$${profit.toLocaleString()}</td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        // é¡¯ç¤ºæ‰€æœ‰å€å¡Š
        function showSections() {
            document.getElementById('settlement-section').classList.remove('hidden');
            document.getElementById('stats-section').classList.remove('hidden');
            document.getElementById('product-section').classList.remove('hidden');
            document.getElementById('daily-section').classList.remove('hidden');
            document.getElementById('detail-section').classList.remove('hidden');
        }
        
        // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
        function showLoading(show) {
            document.getElementById('loading').classList.toggle('hidden', !show);
        }
        
        // é¡¯ç¤ºè¨Šæ¯
        function showMessage(type, message) {
            const errorDiv = document.getElementById('error');
            const successDiv = document.getElementById('success');
            
            if (type === 'error') {
                errorDiv.textContent = message;
                errorDiv.classList.remove('hidden');
                successDiv.classList.add('hidden');
            } else {
                successDiv.textContent = message;
                successDiv.classList.remove('hidden');
                errorDiv.classList.add('hidden');
            }
        }
        
        // éš±è—è¨Šæ¯
        function hideMessages() {
            document.getElementById('error').classList.add('hidden');
            document.getElementById('success').classList.add('hidden');
        }
        
        // åƒ¹æ ¼è¨­å®šåŠŸèƒ½
        async function loadCurrentPrices() {
            try {
                const response = await fetch('/api/current_prices');
                const result = await response.json();
                
                if (result.success) {
                    const prices = result.prices;
                    document.getElementById('chicken-cost').value = prices['é›æ’'].cost;
                    document.getElementById('chicken-price').value = prices['é›æ’'].price;
                    document.getElementById('sweet-potato-cost').value = prices['åœ°ç“œ'].cost;
                    document.getElementById('sweet-potato-price').value = prices['åœ°ç“œ'].price;
                    document.getElementById('drumstick-cost').value = prices['æ£’è…¿'].cost;
                    document.getElementById('drumstick-price').value = prices['æ£’è…¿'].price;
                    document.getElementById('wings-cost').value = prices['é›ç¿…'].cost;
                    document.getElementById('wings-price').value = prices['é›ç¿…'].price;
                    showMessage('success', 'âœ… ç›®å‰åƒ¹æ ¼å·²è¼‰å…¥');
                } else {
                    showMessage('error', 'âŒ è¼‰å…¥åƒ¹æ ¼å¤±æ•—ï¼š' + result.error);
                }
            } catch (error) {
                showMessage('error', 'âŒ è¼‰å…¥åƒ¹æ ¼æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š' + error.message);
            }
        }
        
        async function updatePrice(itemName) {
            const costId = getCostId(itemName);
            const priceId = getPriceId(itemName);
            const cost = parseFloat(document.getElementById(costId).value);
            const price = parseFloat(document.getElementById(priceId).value);
            
            if (isNaN(cost) || isNaN(price)) {
                showMessage('error', 'âŒ è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸å­—');
                return;
            }
            
            try {
                const response = await fetch('/api/update_price', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        item: itemName,
                        cost: cost,
                        price: price
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('success', `âœ… ${itemName} åƒ¹æ ¼å·²æ›´æ–°`);
                } else {
                    showMessage('error', 'âŒ æ›´æ–°åƒ¹æ ¼å¤±æ•—ï¼š' + result.error);
                }
            } catch (error) {
                showMessage('error', 'âŒ æ›´æ–°åƒ¹æ ¼æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š' + error.message);
            }
        }
        
        function getCostId(itemName) {
            const mapping = {
                'é›æ’': 'chicken-cost',
                'åœ°ç“œ': 'sweet-potato-cost',
                'æ£’è…¿': 'drumstick-cost',
                'é›ç¿…': 'wings-cost'
            };
            return mapping[itemName];
        }
        
        function getPriceId(itemName) {
            const mapping = {
                'é›æ’': 'chicken-price',
                'åœ°ç“œ': 'sweet-potato-price',
                'æ£’è…¿': 'drumstick-price',
                'é›ç¿…': 'wings-price'
            };
            return mapping[itemName];
        }
        
        // è¨­å®šé è¨­æ—¥æœŸï¼ˆæ ¹æ“šçœŸå¯¦è³‡æ–™çš„æ—¥æœŸç¯„åœï¼‰
        function setDefaultDates() {
            // çœŸå¯¦è³‡æ–™çš„æ—¥æœŸç¯„åœæ˜¯2025å¹´8æœˆï¼Œè¨­å®šç‚º8æœˆçš„æœ€å¾Œä¸€é€±
            document.getElementById('start-date').value = '2025-08-18';
            document.getElementById('end-date').value = '2025-08-25';
        }
        
        // è¤‡è£½æ–‡å­—æ‘˜è¦
        function copyTextSummary() {
            const textSummary = document.getElementById('text-summary').textContent;
            if (textSummary && textSummary !== 'è¼‰å…¥è³‡æ–™å¾Œæœƒé¡¯ç¤ºè©³ç´°çš„å°å¸³æ‘˜è¦') {
                navigator.clipboard.writeText(textSummary).then(function() {
                    showMessage('success', 'ğŸ“‹ å°å¸³æ‘˜è¦å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
                }).catch(function(err) {
                    // å¦‚æœ clipboard API ä¸å¯ç”¨ï¼Œä½¿ç”¨å‚³çµ±æ–¹æ³•
                    const textArea = document.createElement('textarea');
                    textArea.value = textSummary;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showMessage('success', 'ğŸ“‹ å°å¸³æ‘˜è¦å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
                });
            } else {
                showMessage('error', 'âŒ è«‹å…ˆè¼‰å…¥è³‡æ–™');
            }
        }
        
        // é é¢è¼‰å…¥æ™‚è¨­å®šé è¨­æ—¥æœŸå’Œè¼‰å…¥åƒ¹æ ¼
        window.onload = function() {
            setDefaultDates();
            loadCurrentPrices();
        };
    </script>
</body>
</html>
